# Docker Compose override for 5North DevNet
# Usage: docker compose -f docker-compose.yaml -f docker-compose.devnet.yaml up -d
#
# This overlay:
# - Disables local Canton, Anvil, deployer (using 5North hosted participant + Sepolia)
# - Disables mock-oauth2 and bootstrap (not needed for devnet)
# - Keeps Postgres for relayer and API server state
# - Configures relayer with config.devnet.yaml
# - Configures api-server with config.api-server.devnet.yaml

services:
  # Disable local services - using 5North hosted participant + Sepolia
  canton:
    profiles: ["disabled"]

  anvil:
    profiles: ["disabled"]

  deployer:
    profiles: ["disabled"]

  mock-oauth2:
    profiles: ["disabled"]

  bootstrap:
    profiles: ["disabled"]

  postgres:
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # Relayer connecting to 5North DevNet + Sepolia
  relayer:
    depends_on: !override
      postgres:
        condition: service_healthy
    volumes:
      - ./config.devnet.yaml:/app/config.yaml:ro
    command: ["-config", "/app/config.yaml"]

  # API Server connecting to 5North DevNet
  api-server:
    depends_on: !override
      postgres:
        condition: service_healthy
    volumes:
      - ./config.api-server.devnet.yaml:/app/config.yaml:ro
    command: ["-config", "/app/config.yaml"]

  # Postgres stays enabled for relayer and API server state
